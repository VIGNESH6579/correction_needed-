<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courses - Interview Portal</title>
    <link rel="stylesheet" href="../css/styles.css">
</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container">
            <div class="logo">
                <h1>Interview Portal</h1>
            </div>
            <ul class="nav-links">
                <li><a href="dashboard.html">Dashboard</a></li>
                <li><a href="courses.html">Courses</a></li>
                <li><a href="coding.html">Coding</a></li>
                <li><a href="tests.html">Tests</a></li>
                <li><a href="#" onclick="logout()">Logout</a></li>
            </ul>
        </div>
    </nav>

    <!-- Courses Section -->
    <section class="courses-section">
        <div class="container">
            <h2>Available Courses</h2>
            
            <div id="coursesList" class="courses-grid">
                <p>Loading courses...</p>
            </div>
        </div>
    </section>

    <!-- Quiz Modal -->
    <div id="quizModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeQuiz()">&times;</span>
            <h2 id="quizTitle">Quiz</h2>
            <div id="quizContainer">
                <div id="questionContainer"></div>
                <div id="optionsContainer"></div>
                <button onclick="submitAnswer()" class="btn btn-primary">Submit Answer</button>
                <button onclick="nextQuestion()" class="btn btn-secondary" style="display:none;" id="nextBtn">Next Question</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p>&copy; 2024 Interview Portal. All rights reserved.</p>
        </div>
    </footer>

    <script src="../js/app.js"></script>
    <script>
        let currentCourse = null;
        let currentQuestionIndex = 0;
        let courseQuestions = [];
        let selectedAnswer = null;

        window.addEventListener('load', async () => {
            const token = localStorage.getItem('token');
            if (!token) {
                window.location.href = 'login.html';
                return;
            }

            try {
                const response = await fetch('http://localhost:8080/api/courses', {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                const courses = await response.json();
                displayCourses(courses);
            } catch (error) {
                console.error('Error loading courses:', error);
            }
        });

        function displayCourses(courses) {
            const coursesList = document.getElementById('coursesList');
            coursesList.innerHTML = '';

            courses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'course-card';
                courseCard.innerHTML = `
                    <h3>${course.name}</h3>
                    <p>${course.description}</p>
                    <p><strong>Questions: ${course.totalQuestions}</strong></p>
                    <button onclick="startCourse(${course.id}, '${course.name}')" class="btn btn-primary">Start Course</button>
                `;
                coursesList.appendChild(courseCard);
            });
        }

        async function startCourse(courseId, courseName) {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`http://localhost:8080/api/courses/${courseId}/questions`, {
                    headers: { 'Authorization': 'Bearer ' + token }
                });
                courseQuestions = await response.json();
                currentCourse = { id: courseId, name: courseName };
                currentQuestionIndex = 0;
                selectedAnswer = null;

                document.getElementById('quizTitle').textContent = courseName + ' - Quiz';
                document.getElementById('quizModal').style.display = 'block';
                displayQuestion();
            } catch (error) {
                console.error('Error starting course:', error);
            }
        }

        function displayQuestion() {
            if (currentQuestionIndex >= courseQuestions.length) {
                alert('Quiz completed!');
                closeQuiz();
                return;
            }

            const question = courseQuestions[currentQuestionIndex];
            const questionContainer = document.getElementById('questionContainer');
            const optionsContainer = document.getElementById('optionsContainer');

            questionContainer.innerHTML = `
                <h3>Question ${currentQuestionIndex + 1} of ${courseQuestions.length}</h3>
                <p>${question.questionText}</p>
            `;

            optionsContainer.innerHTML = `
                <div class="option">
                    <input type="radio" name="answer" value="A" onchange="selectedAnswer = 'A'">
                    <label>${question.optionA}</label>
                </div>
                <div class="option">
                    <input type="radio" name="answer" value="B" onchange="selectedAnswer = 'B'">
                    <label>${question.optionB}</label>
                </div>
                <div class="option">
                    <input type="radio" name="answer" value="C" onchange="selectedAnswer = 'C'">
                    <label>${question.optionC}</label>
                </div>
                <div class="option">
                    <input type="radio" name="answer" value="D" onchange="selectedAnswer = 'D'">
                    <label>${question.optionD}</label>
                </div>
            `;
        }

        function submitAnswer() {
            if (!selectedAnswer) {
                alert('Please select an answer');
                return;
            }

            const question = courseQuestions[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correctAnswer;

            alert(isCorrect ? 'Correct!' : 'Incorrect. Correct answer: ' + question.correctAnswer);
            nextQuestion();
        }

        function nextQuestion() {
            currentQuestionIndex++;
            selectedAnswer = null;
            displayQuestion();
        }

        function closeQuiz() {
            document.getElementById('quizModal').style.display = 'none';
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '../index.html';
        }
    </script>
</body>
</html>
